**Домашнее задание к занятию "5.2. Системы управления виртуализацией"**

**Задача 1** **Выберете подходящую систему управления виртуализацией для предложенного сценария. Детально опишите ваш выбор.**

 

Сценарии:

·     ***100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований\***

VMWare ESXi , как более универсальный гипервизор для двух платформ (или KVM). 

Но если, например используются Windows Server OS, то можно рассмотреть и Hyper-V (по лицензированию, например для одной «стандарт» версии можно использовать Хост систему + 2 гостевые, или есть много Windows Server OS, то «windows server datacenter»)

 

 

·     ***Преимущественно Windows based инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий\***

Кластер Hyper-V, в идеале с Management with System Center Virtual Machine Manager (часть System Center).

Сам по себе Hyper-V наиболее оптимальное решение на Windows based инфраструктуры.

Компонент Failover Cluster Manager – позволит настроить высокую доступность машин. 

Компонент Load Balancers используется на настройки балансировки.

Сам Hyper-V позволяет делать экспорт машин на горячую, с помощью System Center Virtual Machine Manager может настроить автоматизированное резервное копирование. Или автоматизировать с помощью набора скриптов.

 

·     ***Требуется наиболее производительное бесплатное opensource решение для виртуализации небольшой (20 серверов) инфраструктуры Linux и Windows виртуальных машин\***

KVM, обеспечит лучшею производительность для Windows system, чем Xen(полная виртуализация). 

Если рассматривались не opensource, но также бесплатные, то можно было ещё рассмотреть ESXi (при присутствии официальной compatibility аппаратной части).

 

·     ***Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows инфраструктуры\***

Microsoft Hyper-V Server как бесплатное без GUI-интерфейса, если используются от 2 серверных ОС в качестве гостя, то можно поставить полноценную Windows Server + Hyper-V.

 

·     ***Необходимо рабочее окружение для тестирование программного продукта на нескольких дистрибутивах Linux\***

Для рабочего окружения будет достаточно «Oracle VM VirtualBox» + для удобства можно использовать с Vagrant. (Если есть лицензия можно и VMWare workstation, например если ещё будут использоваться Windows с то в этом решении лучше видеодрайвер-ускоритель)



**Задача 2**.***Опишите сценарий миграции с VMware vSphere на Hyper-V для Linux и Windows виртуальных машин. Детально опишите необходимые шаги для использования всех преимуществ Hyper-V для Windows.\***

  

**1)P2V Online для** **Windows.**

Для Windows - варианты миграции могут различаться в зависимости от требований по простою виртуальных машин и наличия **SCVMM**. Если мы имеем SCVMM, то может применять P2V Online перенос.

Требования: ОС Windows Server 2003 и старше, не нагруженный сервер (не контроллер домена, не сервер БД), тома только с NTFS.  На гостевую машину останавливается, на гостевую ставится VMM-агент.

 C помощью VSS передается файл на машину с Hyper-V, когда процесс завершается на новом месте создается новая машина Hyper-V (с теми же параметрами, Mac-адресами).

 

**2)Для Linux машин: V2VSCVMM**, нужно, чтобы на узле Hyper-V был установлен VMM-агент, установлена библиотека SCVMM), Инфраструктура должна быть управляема vCenter, vCenter должен быть зарегистрирован в SCVMM, у пользователя, который запускает конвертацию должны быть права администратора vSphere, и правами на узлах Hyper-V

Запускается процесс миграции через SCVMM, копируется диск с vSphere на Hyper-V, конвертируется, создается аналогичная машина с той же конфигурацией на Hyper-V.

 

3) Для Windows-машин. При отсутствии **SCVMM,** и или несоблюдении вышенаписанных требований используется V2V офлайн миграция. 

Утилита Microsoft Virtual Machine converter (бесплатнпя), для не старых версий, подключается к инфраструктуре VMware, на машине должна стоять утилита VMware Tools.

Конвертор проводит анализ внутри ОС, забирает диск на узел Hyper-V, конвертирует его в VHD-файл, требует наличия NTFS-файловой системы внутри виртуальной машины, потому что требует работы с агентом MVMC(Microsoft Virtual Machine converter)  на виртуальной машине.

 

4) Для любой машины. Выключаем машину, копируем на хост Hyper-V. Конвертируем диски, с помощью сторонней утилиты. Например, утилита StarWind V2V Converter. Создаем аналогичную по конфигурации машину в Hyper-V, подключаем к ней диск, придется настроить сетевой интерфейс повторно. 

 

5) Дополнительно. Есть ещё практика переноса машины через NFS в полу-онлайн режиме средствами Storage Vmotion Vmware на диск доступный Hyper-V. Выключение машину, переносим через консоль VMware vSphere vCenter . Вручную создаем машину с той же конфигурацией в Hyper-V. Конвертация диска производится «ручным» изменением файла, дозаписать заголовок в конце файла VMDK. Подключение диска. Запуск машины, опять же потребуется повторная настройка сетевых интерфейсов.







