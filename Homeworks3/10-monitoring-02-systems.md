# Домашнее задание к занятию "10.02. Системы мониторинга"

## Обязательные задания

> 1. Опишите основные плюсы и минусы pull и push систем мониторинга.
          
                      
                       
**Push-модель (+):**  
+Упрощение репликации данных в разные системы мониторинга или их резервные копии (на клиенте настраивается конечная точка отправки или набор таких точек), то есть  можно отправлять сразу в несколько систем (например в realtime-систему и в БД для дальнейшей агрегирования.)  
+UDP является менее затратным способом передачи данных, вследствие чего может вырасти производительность сбора метрик  
+Более гибкая настройка отправки пакетов данных с метриками (на каждом клиенте задается объем данных и частоту отправки)  

**Push-модель (-):**  

- Возможность потери данных из-за UDP  
- Не централизированная настройки, задаются на стороне клиента  

**Pull-модель (+):**  

+ Легче контролировать подлинность данных (гарантия опроса только тех агентов, которые настроены в системе мониторинга). Настройка доступа кто может забирать данные.  
+ Можно настроить единый proxy-server до всех агентов с TLS (таким образом мы можем разнести систему мониторинга и агенты, с гарантией безопасности их взаимодействия)  
+ Упрощенная отладка получения данных с агентов (так как данные запрашиваются посредством HTTP, можно самостоятельно запрашивать эти данные, используя ПО вне системы мониторинга)  

**Pull-модель (-):**  

- Меньше производительность при передаче (но не значительно если данные не меняются и так как передача идет, режа как правило, чем в push-системах)  
- Информация о проблемах придет с задержкой относительно push-системы  
      





2. > Какие из ниже перечисленных систем относятся к push модели, а какие к pull? А может есть гибридные?  
>
    
    - **Prometheus**   
    
      pull-модель (но может push тоже)  
    
    - **TICK**  
    
      push-модель (но можно настроить и pull)  
    
    - **Zabbix**   
    
      Гибридныая (push\ pull)  
    
    - **VictoriaMetrics**  
    
      pull-модель (но может быть настроен push-mode тоже)  
    
    - **Nagios**  
    
      Гибридныая (push\ pull)  





> 3. Склонируйте себе [репозиторий](https://github.com/influxdata/TICK-docker/tree/master/1.3) и запустите TICK-стэк, 
> используя технологии docker и docker-compose.
>
> В виде решения на это упражнение приведите выводы команд с вашего компьютера (виртуальной машины):

- **curl http://localhost:8086/ping**  

Пусто (нет ошибок)  

**curl http://localhost:8888**     

    <!DOCTYPE html>
    <html>
    
      <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
        <title>Chronograf</title>
      <link rel="shortcut icon" href="/favicon.ico"><link href="/chronograf.css" rel="stylesheet"></head>
    
      <body>
        <div id='react-root' data-basepath=""></div>
    
      <script type="text/javascript" src="/manifest.0b50876f6444e513725c.js"></script><script type="text/javascript" src="/vendor.36ee797884f822b1fbde.js"></script><script type="text/javascript" src="/app.3eec41dc0f57667d6ff4.js"></script></body>
    
    </html>   


- **curl http://localhost:9092/kapacitor/v1/ping**

Пусто (нет ошибок)





**А также скриншот веб-интерфейса ПО chronograf (`http://localhost:8888`).**   
https://prnt.sc/xykvye

> P.S.: если при запуске некоторые контейнеры будут падать с ошибкой - проставьте им режим `Z`, например
> `./data:/var/lib:Z`





>
> 4. Перейдите в веб-интерфейс Chronograf (`http://localhost:8888`) и откройте вкладку `Data explorer`.
>
>     - Нажмите на кнопку `Add a query`
>     - Изучите вывод интерфейса и выберите БД `telegraf.autogen`
>     - В `measurments` выберите mem->host->telegraf_container_id , а в `fields` выберите used_percent. 
>     Внизу появится график утилизации оперативной памяти в контейнере telegraf.
>     - Вверху вы можете увидеть запрос, аналогичный SQL-синтаксису. 
>     Поэкспериментируйте с запросом, попробуйте изменить группировку и интервал наблюдений.
>
> Для выполнения задания приведите скриншот с отображением метрик утилизации места на диске 
> (disk->host->telegraf_container_id) из веб-интерфейса.

https://prnt.sc/xyldln





>
> 5. Изучите список [telegraf inputs](https://github.com/influxdata/telegraf/tree/master/plugins/inputs). 
> Добавьте в конфигурацию telegraf следующий плагин - [docker](https://github.com/influxdata/telegraf/tree/master/plugins/inputs/docker):
> ```
> [[inputs.docker]]
>   endpoint = "unix:///var/run/docker.sock"
> ```
>
> Дополнительно вам может потребоваться донастройка контейнера telegraf в `docker-compose.yml` дополнительного volume и 
> режима privileged:
> ```
>   telegraf:
>     image: telegraf:1.4.0
>     privileged: true
>     volumes:
>       - ./etc/telegraf.conf:/etc/telegraf/telegraf.conf:Z
>       - /var/run/docker.sock:/var/run/docker.sock:Z
>     links:
>       - influxdb
>     ports:
>       - "8092:8092/udp"
>       - "8094:8094"
>       - "8125:8125/udp"
> ```
>
> После настройке перезапустите telegraf, обновите веб интерфейс и приведите скриншотом список `measurments` в 
> веб-интерфейсе базы telegraf.autogen . Там должны появиться метрики, связанные с docker.
>
> Факультативно можете изучить какие метрики собирает telegraf после выполнения данного задания.  
>

В конфиге [[inputs.docker]]  
Закомментировал   
  #gather_services = false  
и   
  #source_tag = false (была ошибка, что параметры не найдены в docker)  
https://prnt.sc/xzmwv9  



>
> ## Дополнительное задание (со звездочкой*) - необязательно к выполнению
>
> В веб-интерфейсе откройте вкладку `Dashboards`. Попробуйте создать свой dashboard с отображением:
>

>     - утилизации ЦПУ
>     - количества использованного RAM
>     - утилизации пространства на дисках
>     - количество поднятых контейнеров
>     - аптайм
>     - ...
>     - фантазируйте)
>



https://prnt.sc/xzngpi
